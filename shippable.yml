
language: node_js

node_js:
  - 5.6.1 # shippable image version

branches:
  only:
    - master
    - lidar

build:
  ci:
    - yarn install
    - yarn run build:prod # todo: run tests too
    - pip install --upgrade botocore # workaround https://github.com/Shippable/support/issues/3304
    - pip install setuptools==34.0.1
    # workaround uglify.js shipping with 1969 timestamps
    - touch -t 200001010000 /tmp/timestamp # make a file with a timestamp of the year 2000
    - find . ! -newer /tmp/timestamp -exec touch -t 201701010000 '{}' \; # update all files with earlier timestamps
  post_ci:
    - if [ "$BRANCH" == "master" ]; then EBENV="live"; else EBENV=$BRANCH; fi

integrations:
  deploy:
    - integrationName: "aws-jncc-prod-subscription-integration"
      type: aws
      target: eb_paas
      platform: "Node.js"
      application_name: deli
      env_name: deli-$EBENV
      region: "eu-west-1"

