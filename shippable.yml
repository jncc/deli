
language: node_js

# not sure why i used an old node.js - todo update to v6 / latest
node_js:
  -

# only build master and all branches beginning with "beta"
branches:
  only:
    - master # - beta*

build:
  ci:
    - npm install
    - npm run build:prod
    # todo: run tests too
  post_ci:
    - ls -a
    - pwd
    # DockerHub
    - docker build -t="sumothecat/deli:$BRANCH.$BUILD_NUMBER" .
    - docker push sumothecat/deli:$BRANCH.$BUILD_NUMBER
    # workaround https://github.com/Shippable/support/issues/3304
    - pip install --upgrade botocore

integrations:
  deploy:
    - integrationName: "aws-jncc-prod-subscription-integration"
      type: aws
      #target: eb_paas
      #platform: "Node.js"
      application_name: deli
      env_name: deli-live
      region: "eu-west-1"
      image_name: "sumothecat/deli"
      image_tag: "$BRANCH.$BUILD_NUMBER"

  hub:
    - integrationName: "docker-hub-integration"
      type: docker
