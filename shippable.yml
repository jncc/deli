
language: node_js

node_js:
  - 6.9.4

branches:
  only:
    - master
    - eocoe
    - lidar

build:
  ci:
    # tenant-specific configuration
    - cp -f ./app.client/config/config.$BRANCH.ts ./app.client/config/config.ts
    - cp -f ./app.client/styles/config.$BRANCH.ts ./app.client/styles/config.ts
    - cp -f ./app.server/config/config.$BRANCH.ts ./app.server/config/config.ts
    - cp -f ./app.server/data/data.$BRANCH.ts ./app.server/data/data.ts
    # build
    - yarn install
    - yarn run build:prod
    # workaround https://github.com/Shippable/support/issues/3304
    - pip install --upgrade botocore
    - pip install setuptools==34.0.1
    # workaround https://github.com/mishoo/UglifyJS2/issues/2054
    - find ./node_modules/* -mtime +10950 -exec touch {} \;

integrations:
  deploy:
    - integrationName: "aws-jncc-prod-subscription-integration"
      type: aws
      target: eb_paas
      platform: "Node.js"
      application_name: deli
      env_name: deli-$BRANCH
      region: "eu-west-1"

